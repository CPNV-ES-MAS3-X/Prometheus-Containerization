version: '2'
services:
  ldap:
    image: osixia/openldap:1.5.0
    container_name: ldap
    restart: unless-stopped
    environment:
        - LDAP_ORGANISATION=cas
        - LDAP_DOMAIN=cas.local
        - "LDAP_BASE_DN=dc=cas,dc=local"
        - LDAP_ADMIN_PASSWORD='password'
    ports:
        - 389:389
        - 636:636
    volumes:
      - ./config_files:/etc/ldap/content

    command:
      - ldapadd -x -H ldap://localhost -D "cn=admin,dc=cas,dc=local" -f /etc/ldap/content/base.ldif -w password
      - ldapadd -x -H ldap://localhost -D "cn=admin,dc=cas,dc=local" -f /etc/ldap/content/users.ldif -w password
      - ldappasswd -H ldap://localhost -s 'password' -D "cn=admin,dc=cas,dc=local" -x "uid=man1,ou=users,dc=cas,dc=local" -w password
      - ldappasswd -H ldap://localhost -s 'password' -D "cn=admin,dc=cas,dc=local" -x "uid=man2,ou=users,dc=cas,dc=local" -w password
      - ldappasswd -H ldap://localhost -s 'password' -D "cn=admin,dc=cas,dc=local" -x "uid=ing1,ou=users,dc=cas,dc=local" -w password
      - ldappasswd -H ldap://localhost -s 'password' -D "cn=admin,dc=cas,dc=local" -x "uid=ing2,ou=users,dc=cas,dc=local" -w password
      - ldappasswd -H ldap://localhost -s 'password' -D "cn=admin,dc=cas,dc=local" -x "uid=dev1,ou=users,dc=cas,dc=local" -w password
      - ldapadd -H ldap://localhost -x -D "cn=admin,dc=cas,dc=local" -f /etc/ldap/content/groups.ldif -w password
      - ldapmodify -H ldap://localhost -x -D "cn=admin,dc=cas,dc=local" -f /etc/ldap/content/addtogroup.ldif -w password


ldapadd -x -H ldap://localhost -D "cn=admin,dc=cas,dc=local" -f /etc/ldap/content/base.ldif -w password
adding new entry "uid=monuo,dc=cas,dc=local"
ldapsearch -x -H ldap://localhost:389 -b dc=cas,dc=local -D "cn=admin,dc=cas,dc=local" -w password